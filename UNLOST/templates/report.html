{% extends 'base.html' %}

{% block content %}
<div class="container container-medium">
    <h1 class="page-title">Report an Item</h1>

    <div class="card">
        <div class="card-body">
            <form action="{{ url_for('report') }}" method="POST" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="title">Item Title</label>
                    <input type="text" id="title" name="title" required placeholder="e.g. Blue Jansport Backpack">
                </div>

                <div class="form-group">
                    <label for="status">Status</label>
                    <select id="status" name="status" required onchange="toggleSecuritySection(this.value)">
                        <option value="Lost">Lost - I lost something</option>
                        <option value="Found">Found - I found something</option>
                    </select>
                </div>

                <div id="security-section"
                    style="display: none; background-color: #f0f9ff; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem; border: 1px solid #bae6fd;">
                    <h3 style="margin-top: 0; font-size: 1.2rem; color: #0284c7; margin-bottom: 0.5rem;">
                        <i class="fa-solid fa-shield-halved"></i> Smart Claim Protection
                    </h3>
                    <p style="font-size: 0.9rem; margin-bottom: 1rem; color: #334155;">
                        Prevent false claims by setting a security question that only the true owner would know answer
                        to.
                    </p>
                    <div class="form-group">
                        <label for="security_question">Security Question</label>
                        <input type="text" id="security_question" name="security_question"
                            placeholder="e.g. What is the wallpaper image on the lock screen?">
                    </div>
                    <div class="form-group">
                        <label for="security_answer">Answer</label>
                        <input type="text" id="security_answer" name="security_answer"
                            placeholder="e.g. A photo of a golden retriever">
                    </div>
                </div>

                <div class="form-group">
                    <label for="category">Category</label>
                    <select id="category" name="category" required>
                        <option value="">Select a category</option>
                        <option value="Electronics">Electronics</option>
                        <option value="Documents">Documents</option>
                        <option value="Clothing">Clothing</option>
                        <option value="Accessories">Accessories</option>
                        <option value="Books">Books/Stationery</option>
                        <option value="Other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="date">Date Lost/Found</label>
                    <input type="date" id="date" name="date" required>
                </div>

                <div class="form-group">
                    <label for="location">Location</label>
                    <input type="text" id="location" name="location" required placeholder="e.g. Library 2nd Floor">
                </div>

                <div class="form-group">
                    <label for="description">Description</label>
                    <textarea id="description" name="description" rows="5" required
                        placeholder="Provide details like color, brand, unique marks..."></textarea>
                </div>

                <div class="form-group">
                    <label>Upload Image</label>
                    <div class="file-upload-wrapper">
                        <input type="file" id="image" name="image" accept="image/*" class="file-upload-input"
                            onchange="updateFileName(this)">
                        <div class="file-upload-content" id="file-upload-text">
                            <i class="fa-solid fa-cloud-arrow-up"></i>
                            <span>Click to upload image</span>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="contact_info">Contact Details</label>
                    <input type="text" id="contact_info" name="contact_info" required
                        placeholder="Email or Phone Number">
                    <small style="color: var(--color-text-muted); display: block; margin-top: 0.5rem;">This will be
                        visible to
                        users who view this item.</small>
                </div>

                <button type="submit" class="btn btn-primary" style="width: 100%;">Submit Report</button>
            </form>
        </div>
    </div>
</div>

<script>
    // Pre-select status if passed in URL
    const urlParams = new URLSearchParams(window.location.search);
    const statusParam = urlParams.get('status');
    if (statusParam) {
        document.getElementById('status').value = statusParam;
        toggleSecuritySection(statusParam);
    }

    function toggleSecuritySection(status) {
        const section = document.getElementById('security-section');
        if (status === 'Found') {
            section.style.display = 'block';
        } else {
            section.style.display = 'none';
        }
    }

    function updateFileName(input) {
        const fileName = input.files[0]?.name;
        const textElement = document.getElementById('file-upload-text');
        if (fileName) {
            textElement.innerHTML = `<i class="fa-solid fa-check" style="color: #4ade80;"></i><span>${fileName}</span>`;
        } else {
            textElement.innerHTML = `<i class="fa-solid fa-cloud-arrow-up"></i><span>Click to upload image</span>`;
        }
    }
</script>
{% endblock %}